<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generated Page</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Interface</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="global.css">
<script
  src="https://code.jquery.com/jquery-3.7.1.js"
  integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
  crossorigin="anonymous"></script>
<style id="sections-styles">
/* CSS for section section:header */
.app-header {
    background: var(--brand-gradient);
    padding: 70px 30px 48px;
    height: 145px;
  }
  .token-bar {
    display: flex;
    align-items: center;
    background-color: var(--background-white);
    height: 27px;
    padding: 2px 9px;
    border-radius: 6px;
  }
  .token-icon {
    width: 22px;
    height: 23px;
    margin-right: 9px;
  }
  .token-text {
    color: var(--brand-primary);
    font-size: 15px;
    line-height: 18px;
  }
  
  #jwt-input::placeholder {
    color: #EE4D2D;
  }

/* CSS for section section:profile */
.profile-card {
    background-color: var(--background-white);
    margin: -25px 30px 0;
    border-radius: 16px 16px 0 0;
    padding: 30px 20px 29px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 13px;
  }
  .avatar {
    width: 68px;
    height: 68px;
    border-radius: 50%;
    opacity: 0.8;
  }
  .shop-id-badge {
    background-color: rgba(238, 238, 238, 0.4);
    border-radius: 12px;
    padding: 11px 10px;
    width: 260px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    color: var(--text-light);
    font-size: 11px;
    line-height: 13px;
  }

/* CSS for section section:message */
.message-card {
    position: relative;
    background-color: var(--background-white);
    margin: 20px 30px 0;
    min-height: 430px;
    padding: 10px 0;
  }
  .tabs {
    display: flex;
    justify-content: center;
    gap: 4px;
    padding: 0 15px;
    border-bottom: 1px solid #f0f0f0;
  }
  .tab-item {
    flex: 1;
    padding: 4px 0;
    font-size: 16px;
    color: var(--text-secondary);
    text-align: center;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px; /* To align border with container's border */
    cursor: pointer;
    transition: all 0.3s ease;
  }
  .tab-item:hover {
    color: var(--brand-primary);
    opacity: 0.7;
  }
  .tab-item.active {
    color: var(--brand-primary);
    border-bottom-color: var(--brand-primary);
  }
  .message-body {
    padding: 18px 15px 0;
    position: relative;
    padding-bottom: 120px; /* 確保文字不會與 fab-container 重疊 */
  }
  .close-btn {
    position: absolute;
    top: 18px;
    right: 15px;
    width: 25px;
    height: 25px;
    opacity: 0.3;
  }
  .close-line {
    display: block;
    position: absolute;
    width: 16px;
    height: 2px;
    background-color: #000;
    top: 50%;
    left: 50%;
  }
  .line1 {
    transform: translate(-50%, -50%) rotate(-45deg);
  }
  .line2 {
    transform: translate(-50%, -50%) rotate(45deg);
  }
  .message-text {
    font-size: 18px;
    line-height: 30px;
    letter-spacing: 1.8px;
    color: var(--text-primary);
    white-space: pre-wrap;
    margin: 0;
  }
  .fab-container {
    position: absolute; /* 相對於 message-body 定位 */
    bottom: 16px; /* 與底部保持適當距離 */
    left: 50%;
    transform: translateX(-50%);
    width: 85px;
    height: 85px;
    z-index: 10;
    cursor: pointer; /* 顯示手指符號 */
  }
  .fab-container:hover {
    opacity: 0.8; /* 增加視覺反饋 */
  }
  .fab-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
  .fab-icon {
    position: absolute;
    width: 33px;
    height: 30px;
    top: 50%;
    left: 53%;
    transform: translate(-50%, -50%);
  }
  </style>
  <script src="global.js" defer></script>
  <script>
    function clearShopId() {
      const input = document.getElementById('shop-id-input');
      const clearBtn = document.getElementById('clear-btn');
      input.value = '';
      clearBtn.style.display = 'none';
      input.focus();
    }

    function clearJWT() {
      const input = document.getElementById('jwt-input');
      const clearBtn = document.getElementById('jwt-clear-btn');
      input.value = '';
      clearBtn.style.display = 'none';
      input.focus();
    }

    function clearToId() {
      const input = document.getElementById('to-id-input');
      const clearBtn = document.getElementById('to-id-clear-btn');
      input.value = '';
      clearBtn.style.display = 'none';
      input.focus();
    }

    const tabMessages = [
      `您好～\n您詢問的 目前還有喔！\n(無需下單)\n這邊會用全家平台 建立訂單\n貨到付款 $含運\n\n如需要的話請再和我～謝謝您`,
      `您好\n這邊會以全家平台 建立訂單\n請幫我留收件資訊就可以了～\n①姓名\n②手機號碼\n③希望取件的全家超商\n\n貨到付款 $含運\n寄出時會再通知您～謝謝您`,
      `您好～\n還有喔！\n任選兩件可免運\n(或搭配賣場其他商品 滿額免運)\n\n如需要的話請再和我～謝謝您`
    ];

    function switchTab(tabIndex) {
      const tabItems = document.querySelectorAll('.tab-item');
      tabItems.forEach(tab => tab.classList.remove('active'));
      tabItems[tabIndex].classList.add('active');
      const textarea = document.getElementById('tab-message');
      textarea.value = tabMessages[tabIndex];
    }

    function clearTextarea() {
      const textarea = document.getElementById('tab-message');
      textarea.value = '';
    }

    document.addEventListener('DOMContentLoaded', function() {
      const shopInput = document.getElementById('shop-id-input');
      const shopClearBtn = document.getElementById('clear-btn');
      const jwtInput = document.getElementById('jwt-input');
      const jwtClearBtn = document.getElementById('jwt-clear-btn');
      
      // Shop ID input event listener
      shopInput.addEventListener('input', function() {
        if (shopInput.value.length > 0) {
          shopClearBtn.style.display = 'block';
        } else {
          shopClearBtn.style.display = 'none';
        }
      });

      // JWT input event listener
      jwtInput.addEventListener('input', function() {
        if (jwtInput.value.length > 0) {
          jwtClearBtn.style.display = 'block';
        } else {
          jwtClearBtn.style.display = 'none';
        }
      });

      // TO_ID input event listener
      const toIdInput = document.getElementById('to-id-input');
      const toIdClearBtn = document.getElementById('to-id-clear-btn');
      toIdInput.addEventListener('input', function() {
        if (toIdInput.value.length > 0) {
          toIdClearBtn.style.display = 'block';
        } else {
          toIdClearBtn.style.display = 'none';
        }
      });

      // Tab click event listeners
      const tabItems = document.querySelectorAll('.tab-item');
      tabItems.forEach((tab, index) => {
        tab.addEventListener('click', () => switchTab(index));
      });

      // 綁定清除按鈕事件
      const clearBtn = document.querySelector('.close-btn');
      clearBtn.addEventListener('click', clearTextarea);

      const fabContainer = document.querySelector('.fab-container');

      fabContainer.addEventListener('click', function() {
        const jwtInput = document.getElementById('jwt-input').value;
        const shopIdInput = document.getElementById('shop-id-input').value;
        const toIdInput = document.getElementById('to-id-input').value;
        const tabMessage = document.getElementById('tab-message').value;

        // Update the AJAX request to call the Node.js server
        const settings = {
          url: "/api/send-message",
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify({
            jwt: jwtInput,
            shopId: shopIdInput,
            toId: toIdInput,
            message: tabMessage
          })
        };

        $.ajax(settings).done(function(response) {
          console.log(response);
        });
      });

      // 預設切換到第一個 Tab
      switchTab(0);
    });
  </script>
</head>
<body>
<section id="section-header">
  <header class="app-header">
    <div class="token-bar">
      <img src="images/3c992cc2644dd6d0f6304bdf358e041ebacb7155.png" alt="Key icon" class="token-icon">
      <div style="position: relative; display: flex; align-items: center; flex: 1;">
        <input type="text" id="jwt-input" placeholder="JSON Web Token" style="border: none; background: transparent; color: var(--brand-primary); font-size: 15px; line-height: 18px; padding: 0 20px 0 0; width: 100%; outline: none;">
        <button type="button" id="jwt-clear-btn" onclick="clearJWT()" style="position: absolute; right: 2px; background: none; border: none; font-size: 14px; color: var(--brand-primary); cursor: pointer; padding: 0; width: 16px; height: 16px; display: none;">×</button>
      </div>
    </div>
  </header>
</section>
<section id="section-profile">
  <div class="profile-card">
    <img src="images/3cb83d7b7e6f5ae2cd93179671021a2d30b131c7.png" alt="User headshot" class="avatar">
    <div class="shop-id-badge">
      <label for="shop-id-input" style="margin-right: 10px;">SHOP ID</label>
      <div style="position: relative; display: flex; align-items: center;">
        <input type="text" id="shop-id-input" placeholder="" style="border: 1px solid #ccc; border-radius: 4px; padding: 5px 25px 5px 5px; font-size: 11px; width: 160px;">
        <button type="button" id="clear-btn" onclick="clearShopId()" style="position: absolute; right: 5px; background: none; border: none; font-size: 14px; color: #999; cursor: pointer; padding: 0; width: 16px; height: 16px; display: none;">×</button>
      </div>
    </div>
    <div class="shop-id-badge">
      <label for="to-id-input" style="margin-right: 10px;">TO ID</label>
      <div style="position: relative; display: flex; align-items: center;">
        <input type="text" id="to-id-input" placeholder="" style="border: 1px solid #ccc; border-radius: 4px; padding: 5px 25px 5px 5px; font-size: 11px; width: 160px;">
        <button type="button" id="to-id-clear-btn" onclick="clearToId()" style="position: absolute; right: 5px; background: none; border: none; font-size: 14px; color: #999; cursor: pointer; padding: 0; width: 16px; height: 16px; display: none;">×</button>
      </div>
    </div>
  </div>
</section>
<section id="section-message">
  <div class="message-card">
    <nav class="tabs">
      <button class="tab-item active">　①　</button>
      <button class="tab-item">　②　</button>
      <button class="tab-item">　③　</button>
    </nav>
    <div class="message-body">
      <button class="close-btn">
        <span class="close-line line1"></span>
        <span class="close-line line2"></span>
      </button>
      <textarea id="tab-message" class="message-text" style="width:100%; min-height:250px; resize:vertical; border:none; background:transparent; font-size:18px; line-height:30px; letter-spacing:1.8px; color:var(--text-primary); padding:0; margin:0; outline:none; white-space:pre-wrap;">您好～
還有喔！
任選兩件可免運
(或搭配賣場其他商品 滿額免運)

如需要的話請再和我～謝謝您</textarea>
      <div class="fab-container">
        <img src="images/25_446.svg" alt="Send button background" class="fab-bg">
        <img src="images/2fc15ad8e741af50b771cb8b48b25351e8faee9b.png" alt="Send icon" class="fab-icon">
      </div>
    </div>
  </div>
</section>
</body>
</html>